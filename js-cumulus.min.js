/*\
JS-Cumulus - WP-Cumulus in JavaScript (codenamed jscumulus)
Based on Stratus plugin by Dawid Fatyga (fatyga@student.agh.edu.pl)
Based on WP-Cumulus by Roy Tanck (http://www.roytanck.com)

@author Jeroen van Warmerdam (aka jerone or jeronevw) (http://www.jeroenvanwarmerdam.nl)
@date 18-12-2011 18:00
@version 0.2.3

Copyright 2010 - 2011, Jeroen van Warmerdam

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.
\*/
(function(i,e,g){var n={ID:"tagCloud",Class:"tagCloud",Width:400,Heigth:400,Consistent:true,Rank:30,Url:"#",FontMin:10,FontMax:24,Depth:150,AnimationTime:1,HoverStop:85,OverWrite:false};var b=i.TagCloud,m=i.Tag,j=i.Vector,s=i.Surface,f=1,r=Object.prototype.toString,c="[object Object]",l=function(y){return r.call(y)===c},q=function(y){return !!y.nodeType},k=Math.PI/180,o=[],d=[],t=(function(){var y=0,z=3600;while(y<z){o[y]=Math.sin(y/10*k);y++}return function A(B){while(B<0){B+=360}return o[Math.round(B*10)%z]}})(),p=(function(){var y=0,z=3600;while(y<z){d[y]=Math.cos(y/10*k);y++}return function A(B){return d[Math.round(Math.abs(B)*10)%z]}})(),x={Add:(function(){if(e.addEventListener){return function(B,A,z){z=x.Fix.call(this,A==="mouseenter"||A==="mouseleave"?x.mouseEnter(z):z);A=A==="mouseenter"&&"mouseover"||A==="mouseleave"&&"mouseout"||A;B.addEventListener(A,z,false);return function y(){B.removeEventListener(A,z,false);return true}}}else{if(e.attachEvent){return function(B,A,z){z=x.Fix.call(this,z);B.attachEvent("on"+A,z);return function y(){B.detachEvent("on"+A,z);return true}}}}})(),Fix:function(y){return function(B){if(!B.target){B.target=B.srcElement||e}if(B.target.nodeType===3){B.target=B.target.parentNode}if(!B.relatedTarget&&B.fromElement){B.relatedTarget=B.fromElement===B.target?B.toElement:B.fromElement}if(B.pageX===null&&B.clientX!==null){var A=e.documentElement,z=e.body;B.pageX=B.clientX+(A&&A.scrollLeft||z&&z.scrollLeft||0)-(A&&A.clientLeft||z&&z.clientLeft||0);B.pageY=B.clientY+(A&&A.scrollTop||z&&z.scrollTop||0)-(A&&A.clientTop||z&&z.clientTop||0)}y.call(this,B)}},mouseEnter:function(z){var A=function(B,C){if(B===C){return false}while(C&&C!==B){C=C.parentNode}return C===B};return function y(B){var C=B.relatedTarget;if(this===C||A(this,C)){return}z.call(this,B)}}};var a=function(A,C,B){this.set=function(D,F,E){this.x=D||0;this.y=F||0;this.z=E||0};if(A!==g&&l(A)){this.set(A.x,A.y,A.z)}else{this.set(A,C,B)}this.Multiply=function(y){this.x*=y;this.y*=y;this.z*=y;return this};this.Done=function(){return Math.abs(this.x)>0.01||Math.abs(this.y)>0.01||Math.abs(this.z)>0.01}};var u=function(z,y){this.set=function(B,A){this.width=B||0;this.height=A||0};if(z!==g&&l(z)){this.set(z.width,z.height)}else{this.set(z,y)}};var w=function(z,A,y){this.id=A;this.className=y;this.active=false;this.mouse=new a();this.position=new a();this.size=new u({width:z.size.width||n.Width/2,height:z.size.height||n.Heigth/2});this.element=e.createElement("div");this.element.setAttribute("id",this.id);this.element.setAttribute("class",this.className);this.element.style.width=this.size.width+"px";this.element.style.height=this.size.height+"px";this.element.style.display="block";this.Activate=function(){var B=this;x.Add(this.element,"mousemove",function(C){return function(D){if(!z.active){z.Animate()}if(!(!!n.HoverStop&&!this.active)){this.Update();this.mouse.set(((-D.pageY+this.position.y)*2/this.size.height+1)*1.8,((D.pageX-this.position.x)*2/this.size.width-1)*1.8)}}.call(B,C)});x.Add(this.element,"mouseenter",function(){B.active=true});x.Add(this.element,"mouseleave",function(){B.active=false});return this};this.Update=function(){this.position=new a({x:this.element.offsetLeft,y:this.element.offsetTop});return this}};var h=function(E,D,z,B){this.id=f++;this.title=E;this.rank=((!isNaN(D)&&D>=0&&D<=100)?D:n.Rank)/100;this.url=z||(isNaN(D)?D:false)||n.Url;this.position=new a();B=B||l(z)&&z||l(D)&&D||{};var C=e.createElement("a"),y=e.createElement("li");C.setAttribute("id","jsCumulus"+this.id);C.setAttribute("href",this.url);C.innerHTML=this.title;for(var A in B){C.style[A]=B[A]}y.setAttribute("class","tagClass");y.style.position="absolute";y.appendChild(C);this.element=y;this.Activate=function(F){x.Add(this.element,"mouseenter",function(){F.active=false});x.Add(this.element,"mouseleave",function(){F.active=true});return this};this.Update=function(T,J,V,I){T=T||new a();J=J||new a();var P=this.position,H=T.x||0,F=T.y||0,Q=t(H),L=p(H),N=t(F),K=p(F),U=P.y*Q+P.z*L,S=P.x*K+U*N,O=P.y*L+P.z*(-Q),M=P.x*(-N)+U*K,G=n.Depth/(n.Depth+M),R=I-V;P.set(S,O,M);C.style.opacity=Math.max(G-0.7,0)/0.5+0.2;C.style.fontSize=this.rank*G*R+V+"px";y.style.left=(J.x+S*G)-(y.clientWidth/2)+"px";y.style.top=(J.y+O*G)-(y.clientHeight/2)+"px";P=H=F=Q=L=N=K=U=S=O=M=G=R=null;return this}};var v=function(A,B,y,z){if(q(arguments[0])){this.element=arguments[0];A=arguments[1];B=arguments[2];y=arguments[3];z=arguments[4]}z=z||l(y)&&y||l(B)&&B||{};this.fps={timer:null,elm:null,i:0};this.active=false;this.delta=new a(-2,-2);this.size=new u({width:parseFloat(!!parseFloat(B)&&B||!!parseFloat(z.width)&&z.width||n.Width),height:parseFloat(!!parseFloat(y)&&y||!!parseFloat(z.height)&&z.height||B||n.Height)});this.font={min:parseFloat(z.fontMin)||n.FontMin,max:parseFloat(z.fontMax)||n.FontMax};this.radius=z.radius||Math.min(this.size.width,this.size.height)/4;this.consistent=z.consistent!==g?!!z.consistent:n.Consistent;this.overwrite=z.overwrite!==g?!!z.overwrite:n.OverWrite;this.items=A&&A.length&&A.slice(0)||(function(){var D=50,E=0,C=[];for(;D>=E;--D){C[D]=new h("+",100)}return C})();this.attractor=new w(this,z.id||n.ID+Math.floor(Math.random()*10000+1),z.className||n.Class);z=null;this.Distribute=function(F){F=F||this.element||e.body;var C=e.createElement("ul"),G=this.items.length-1,E=0,K;if(this.overwrite){while(F.firstChild){F.removeChild(F.firstChild)}}for(;G>=E;--G){K=this.items[G];if(K instanceof h&&K.title){C.appendChild(K.element);K.Activate(this.attractor)}else{this.items.splice(G,1)}}this.attractor.element.appendChild(C);F.appendChild(this.attractor.element);this.attractor.Activate();C=G=E=null;var D=0,L=0,M=this.items,J=0,I=M.length,H=this.radius;for(;J<I;J++){D=this.consistent?Math.acos(-1+(2*J)/I):Math.random()*(Math.PI);L=this.consistent?Math.sqrt(I*Math.PI)*D:Math.random()*(2*Math.PI);M[J].position.set(H*Math.sin(D)*Math.cos(L),H*Math.sin(D)*Math.sin(L),H*Math.cos(D))}D=L=M=J=I=H=null;this.fps.elm=e.getElementById(this.attractor.id+"_fps");this.Update();return this};this.Update=function(F){this.fps.timer=new Date()*1;F=F||new a();var D=this.attractor.Update(),E=0,C=this.items.length;this.position=new a({x:this.size.width/2+D.position.x,y:this.size.height/2+D.position.y});for(;E<C;E++){this.items[E].Update(F,this.position,this.font.min,this.font.max)}F=D=E=C=null;if(this.fps.elm){this.fps.elm.innerHTML=parseInt(++this.fps.i/((new Date()*1)-this.fps.timer),10)+" fps"}return this};this.Pause=function(){if(this.animation){this.active=false;i.clearInterval(this.animation);this.animation=null;this.fps.timer=null;this.fps.i=0;if(this.fps.elm){this.fps.elm.innerHTML="# fps"}}return this};this.Stop=function(){this.delta=new a();this.Pause();return this};this.Animate=function(D){if(D){this.Stop()}this.active=true;this.delta=D||this.delta||new a();var C=this;this.animation=i.setInterval(function(){return function E(){this.delta=this.attractor.active?this.attractor.mouse:this.delta.Multiply((Math.min(n.HoverStop,99)/10+90)/100);if(this.delta.Done()){this.Update(this.delta)}else{this.Stop()}}.call(C)},n.AnimationTime);return this};if(this.element){this.Distribute(this.element)}};i.TagCloud=v;i.Tag=h;i.Vector=a;i.Surface=u;i.JSCumulus={TagCloud:v,Tag:h,Vector:a,Surface:u,noConflict:function(){i.TagCloud=b;i.Tag=m;i.Vector=j;i.Surface=s;return{TagCloud:v,Tag:h,Vector:a,Surface:u}}}})(window,window.document);